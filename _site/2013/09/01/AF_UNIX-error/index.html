<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>使用AF_UNIX中由头文件引发的错误 &#8211; 高手之路</title>
<meta name="description" content="">
<meta name="keywords" content="">


<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="使用AF_UNIX中由头文件引发的错误">
<meta property="og:description" content="专注于linux下程序设计">
<meta property="og:url" content="http://localhost:4000/2013/09/01/AF_UNIX-error/">
<meta property="og:site_name" content="高手之路">





<link rel="canonical" href="http://localhost:4000/2013/09/01/AF_UNIX-error/">
<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="高手之路 Feed">
<link rel="author" href="https://plus.google.com/ucshell.neo@gmail.com?rel=author">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>
<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.min.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="http://localhost:4000/assets/js/vendor/html5shiv.min.js"></script>
	<script src="http://localhost:4000/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://localhost:4000/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="http://localhost:4000">高手之路</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				<li><a href="http://localhost:4000" >Home</a></li>
		        
				<li><a href="http://localhost:4000/posts/" >Posts</a></li>
		        
				<li><a href="http://localhost:4000/about/" >About</a></li>
		        
				<li><a href="http://localhost:4000/comment/" >Leave a message</a></li>
		        
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <div class="article-author-side">
    <img src="http://localhost:4000/images/Neo.jpg" class="bio-photo" alt="Neo bio photo"></a>
<h3>Neo</h3>
<p>每一个优秀的人,都会有一段沉默的时光. 那一段时光,是付出了很多努力,忍受孤独和寂寞,不抱怨不诉苦. 日后说起时,连自己都能被感动的日子.</p>


<a href="https://plus.google.com/ucshell.neo@gmail.com" class="author-social" target="_blank"><i class="icon-google-plus"></i> Google+</a>










  </div>
  <article>
    <div class="headline-wrap">
      <h1>使用AF_UNIX中由头文件引发的错误</h1>
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p>今天使用unix域函数时候出现了一大屏奇怪的错误，程序很简单，程序本身是没有什么错误的！问题的关键就是头文件,我使用sockaddr_un的地址与AF_UNIX来编写，但是我的头文件中有&lt;netinet/in.h>这个文件,就是这个文件导致的错误，为了找出这个错误，我把头文件一个一个的注释掉来排查，终于找到了错误，只要把# include &lt;netinet/in.h>去掉就可以了，这也是经验吧，以后写<strong>网络通信时候就不要加&lt;linux/un.h></strong> ，<strong>本地通信的时候就不要加&lt;*/in.h></strong></p>

<p><strong>&lt;netinet/in.h>与&lt;linux/in.h>同时使用也会造成错误</strong></p>

<p><strong>同时头文件的先后顺序也可能造成一些错误</strong></p>

<pre><code># include &lt;unistd.h&gt;
# include &lt;stdio.h&gt;
# include &lt;signal.h&gt;
# include &lt;stdlib.h&gt;
# include &lt;sys/types.h&gt;
# include &lt;sys/socket.h&gt;
# include &lt;linux/un.h&gt;
# include &lt;string.h&gt;
# include &lt;errno.h&gt;
# include &lt;fcntl.h&gt;
# include &lt;sys/ipc.h&gt;
# include &lt;sys/mman.h&gt;
# include &lt;sys/shm.h&gt;
# include &lt;linux/in.h&gt;
//# include &lt;netinet/in.h&gt;
static void display_err(const char* on_what)
{
        perror(on_what);
        exit(1);
}

int main(int argc, char** argv)
{
        int error;
        int sock_unix;
        struct sockaddr_un addr_unix;
        int len_unix;
        const char path[] = "./test";

        sock_unix = socket(AF_UNIX, SOCK_STREAM, 0);
        if(-1 == sock_unix)
        {
                display_err("socket()");
        }

        memset(&amp;addr_unix, 0, sizeof(addr_unix));

        addr_unix.sun_family = AF_LOCAL;
//      strcpy();
        memcpy(addr_unix.sun_path, path, strlen(path));
        len_unix = sizeof(struct sockaddr_un);

        error = bind(sock_unix, (struct sockaddr*)&amp;addr_unix, len_unix);

        if(-1 == error)
        {
                display_err("bind()");
        }
        close(sock_unix);
        unlink(path);

        return 0;
}
</code></pre>

<p>错误代码如下</p>

<pre><code>[root@localhost network]# cc sock_unix.c -omain
In file included from /usr/include/arpa/inet.h:23,
from include.h:16,
from sock_unix.c:1:
/usr/include/netinet/in.h:34: 错误：枚举‘IPPROTO_IP’重声明
/usr/include/linux/in.h:26: 附注：‘IPPROTO_IP’的上一个定义在此
/usr/include/netinet/in.h:38: 错误：枚举‘IPPROTO_ICMP’重声明
/usr/include/linux/in.h:27: 附注：‘IPPROTO_ICMP’的上一个定义在此
/usr/include/netinet/in.h:40: 错误：枚举‘IPPROTO_IGMP’重声明
/usr/include/linux/in.h:28: 附注：‘IPPROTO_IGMP’的上一个定义在此
/usr/include/netinet/in.h:42: 错误：枚举‘IPPROTO_IPIP’重声明
/usr/include/linux/in.h:29: 附注：‘IPPROTO_IPIP’的上一个定义在此
/usr/include/netinet/in.h:44: 错误：枚举‘IPPROTO_TCP’重声明
/usr/include/linux/in.h:30: 附注：‘IPPROTO_TCP’的上一个定义在此
/usr/include/netinet/in.h:46: 错误：枚举‘IPPROTO_EGP’重声明
/usr/include/linux/in.h:31: 附注：‘IPPROTO_EGP’的上一个定义在此
/usr/include/netinet/in.h:48: 错误：枚举‘IPPROTO_PUP’重声明
/usr/include/linux/in.h:32: 附注：‘IPPROTO_PUP’的上一个定义在此
/usr/include/netinet/in.h:50: 错误：枚举‘IPPROTO_UDP’重声明
/usr/include/linux/in.h:33: 附注：‘IPPROTO_UDP’的上一个定义在此
/usr/include/netinet/in.h:52: 错误：枚举‘IPPROTO_IDP’重声明
/usr/include/linux/in.h:34: 附注：‘IPPROTO_IDP’的上一个定义在此
/usr/include/netinet/in.h:56: 错误：枚举‘IPPROTO_DCCP’重声明
/usr/include/linux/in.h:35: 附注：‘IPPROTO_DCCP’的上一个定义在此
/usr/include/netinet/in.h:58: 错误：枚举‘IPPROTO_IPV6’重声明
/usr/include/linux/in.h:39: 附注：‘IPPROTO_IPV6’的上一个定义在此
/usr/include/netinet/in.h:64: 错误：枚举‘IPPROTO_RSVP’重声明
/usr/include/linux/in.h:36: 附注：‘IPPROTO_RSVP’的上一个定义在此
/usr/include/netinet/in.h:66: 错误：枚举‘IPPROTO_GRE’重声明
/usr/include/linux/in.h:37: 附注：‘IPPROTO_GRE’的上一个定义在此
/usr/include/netinet/in.h:68: 错误：枚举‘IPPROTO_ESP’重声明
/usr/include/linux/in.h:41: 附注：‘IPPROTO_ESP’的上一个定义在此
/usr/include/netinet/in.h:70: 错误：枚举‘IPPROTO_AH’重声明
/usr/include/linux/in.h:42: 附注：‘IPPROTO_AH’的上一个定义在此
/usr/include/netinet/in.h:82: 错误：枚举‘IPPROTO_PIM’重声明
/usr/include/linux/in.h:44: 附注：‘IPPROTO_PIM’的上一个定义在此
/usr/include/netinet/in.h:84: 错误：枚举‘IPPROTO_COMP’重声明
/usr/include/linux/in.h:46: 附注：‘IPPROTO_COMP’的上一个定义在此
/usr/include/netinet/in.h:86: 错误：枚举‘IPPROTO_SCTP’重声明
/usr/include/linux/in.h:47: 附注：‘IPPROTO_SCTP’的上一个定义在此
/usr/include/netinet/in.h:88: 错误：枚举‘IPPROTO_UDPLITE’重声明
/usr/include/linux/in.h:48: 附注：‘IPPROTO_UDPLITE’的上一个定义在此
/usr/include/netinet/in.h:90: 错误：枚举‘IPPROTO_RAW’重声明
/usr/include/linux/in.h:50: 附注：‘IPPROTO_RAW’的上一个定义在此
/usr/include/netinet/in.h:93: 错误：枚举‘IPPROTO_MAX’重声明
/usr/include/linux/in.h:52: 附注：‘IPPROTO_MAX’的上一个定义在此
/usr/include/netinet/in.h:143: 错误：‘struct in_addr’重定义
/usr/include/netinet/in.h:226: 错误：‘struct sockaddr_in’重定义
/usr/include/netinet/in.h:252: 错误：‘struct ip_mreq’重定义
/usr/include/netinet/in.h:261: 错误：‘struct ip_mreq_source’重定义
/usr/include/netinet/in.h:288: 错误：‘struct group_req’重定义
/usr/include/netinet/in.h:297: 错误：‘struct group_source_req’重定义
/usr/include/netinet/in.h:311: 错误：‘struct ip_msfilter’重定义
/usr/include/netinet/in.h:332: 错误：‘struct group_filter’重定义
In file included from /usr/include/netinet/in.h:356,
from /usr/include/arpa/inet.h:23,
from include.h:16,
from sock_unix.c:1:
/usr/include/bits/in.h:107: 错误：‘struct ip_mreqn’重定义
/usr/include/bits/in.h:115: 错误：‘struct in_pktinfo’重定义
</code></pre>

      <hr />
      <footer role="contentinfo">
        <div class="article-author-bottom">
          <img src="http://localhost:4000/images/Neo.jpg" class="bio-photo" alt="Neo bio photo"></a>
<h3>Neo</h3>
<p>每一个优秀的人,都会有一段沉默的时光. 那一段时光,是付出了很多努力,忍受孤独和寂寞,不抱怨不诉苦. 日后说起时,连自己都能被感动的日子.</p>


<a href="https://plus.google.com/ucshell.neo@gmail.com" class="author-social" target="_blank"><i class="icon-google-plus"></i> Google+</a>










        </div>
        <p class="byline"><strong>使用AF_UNIX中由头文件引发的错误</strong> was published on <time datetime="2013-09-01T13:25:44Z">September 01, 2013</time> by <a href="http://localhost:4000/about" title="About Neo">Neo</a>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="http://localhost:4000/posts/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="http://localhost:4000/2014/03/15/dynamic-link-libary/" title="静态连接与动态连接的区别">静态连接与动态连接的区别</a></li>
    
      <li><a href="http://localhost:4000/2014/03/15/compile-link/" title="程序编译的过程">程序编译的过程</a></li>
    
      <li><a href="http://localhost:4000/2014/03/14/memory-variable/" title="各种变量在程序内存中的分布">各种变量在程序内存中的分布</a></li>
    
    </ul>
    <hr />
        <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'ucshellcom'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
  </div><!-- /.related-articles -->
  <footer>
    <br></br>
<br></br>
<span>&copy; 2013 - 2014 高手之路 ucshell.com , All Rights Reserved.   </span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://localhost:4000/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://localhost:4000/assets/js/scripts.min.js"></script>
	        

</body>
</html>
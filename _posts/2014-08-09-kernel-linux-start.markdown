---
layout: post
title: linux启动流程
description:  
modified: 
categories: 
- KERNEL
tags:
- 
---

主要步骤:
- cpu自身初始化
- BIOS
- 内核引导程序
- 自解压内核
- 内核启动


#### CPU自身初始化
CPU初始化之后，从某个固定为止(一般是0xfffffff0)取得指令并执行，该指令为转跳指令，转跳到BIOS代码的首部

#### BIOS

BIOS的工作主要有两个:
- 加电自检POST
- 加载内核引导程序

POST阶段完成系统硬件的检测，例如内存，总线等

POST完成之后，BIOS读取启动设备第一个扇区，即首512字节信息(又称主引导记录MBR),MBR中保存了内核引导程序的开始部分，BIOS将其加载到内核并执行。

#### 内核引导程序
内核引导程序分为两个阶段:
- MBR中的主引导程序
- 活动分区引导记录中的次引导程序

MBR中的主引导程序是512字节的映像，其包含了446字节的程序代码和64字节的分区表，最后两个字节固定为0xAA55,用于检测MBR是否有效。

主引导记录扫描分区表，寻找活动分区，将位于活动分区引导记录中的次引导记录加载到内存并执行。

次引导记录负责加载Linux内核映像，并将控制权交给内核。

PC中内核引导程序通常为GRUB或是LILO

#### 内核
内核映像被加载到内存并获得控制权之后，内核阶段开始工作。

内核映像是以压缩的形式存储，并不是一个可执行的内核，所以，内核阶段首要工作是自解压内核映像。

内核编译生出vmlinuz之后，通常会对其进行压缩，形成zImage(小于512k)或bzImage(大于512k)，在zImage和bzImage头部都嵌有自解压程序

最后,init/main.c中的start_kernel函数被调用，进入体系结构无关的内核部分，此后内核的引导过程就结束了，开始进入了内核的初始化过程

-------------------------------------------------------------------------------

引导过程可以简单归纳为:

CPU加载BIOS，BIOS加载内核引导程序，内核引导程序加载压缩内核，压缩内核加载解压内核

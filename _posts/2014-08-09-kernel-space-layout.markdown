---
layout: post
title: 内核空间的布局
description:  
modified: 
categories: 
- KERNEL
tags:
- 
---



        | 直接映射区   | 动态映射区  | KMAP区  | 固定映射区  |
        |------------+------------+--------+------------|
        | 896M       | 120M       | 4M     | 4M         |
        |------------+------------+--------+------------|
		3G         线性地址                              4G

内核空间分布

#### 直接映射区(Direct Memory Region)
从3G开始，最大896M的线性地址区间，称为直接内存映射区，因为该区域的线性地址和物理地址之间存在线性转换关系

	线性地址 = 3G + 物理地址

例如:
物理地址区间0x10000-0x20000映射到线性空间就是3G+0x10000-3G+0x20000

#### 动态映射区(Vmalloc Region)
该区域的地址是由内核函数vmalloc来分配的，其特点是线性空间连续，物理空间不一定连续，vmalloc分配的线性地址所对应的物理页可能处于低端内存，也可能处于高端内存。


#### 永久内存映射区域(PKMap Region)
对于896M以上的高端内存，可以使用该区域来访问,访问方法:
1. 使用alloc_page(__GFP_HIGHMEM)分配高端内存页;
2. 使用kmap函数将分配到的高端内存映射到该区域;


#### 固定映射区(Fixing Mapping Region)
PKMap区域上面有4M的线性空间，被称为固定映射区，固定映射区中每个地址项都用于特定的用途。


什么是高端内存?

物理地址中高于896M的就称为高端内存

	物理内存
	1G
	-----
	|   |------->1G
	|   | 高端内存     
	|   |------->896M
	|   |
	|   |
	|   |
	|   |
	|   |------->0G
	-----

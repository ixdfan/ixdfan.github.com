---
layout: post
title:  利用sar来查看CPU和I/O使用情况
description: 
modified: 
categories: 
- SHELL 
tags:
- 
---

sar可以查看CPU使用率和I/O等待比例


	[root@ work]# sar
	Linux 3.11.10-301.fc20.i686 (localhost.localdomain) 	06/18/2014 	_i686_	(4 CPU)
	
	09:20:01 AM     CPU     %user     %nice   %system   %iowait    %steal     %idle
	09:30:01 AM     all      5.23      0.01      1.26      0.98      0.00     92.52
	09:40:01 AM     all      1.40      0.00      0.52      0.75      0.00     97.33
	09:50:01 AM     all      3.42      0.00      1.04      1.50      0.00     94.03
	10:00:01 AM     all      1.57      0.00      0.68      0.52      0.00     97.22
	10:10:01 AM     all      5.26      0.00      1.58      1.39      0.00     91.77

	%user是CPU在用户模式下的使用率
	%system是CPU在系统模式下的使用率
	

如果使用uptime显示的平均负载过高,并且sar此处显示CPU使用率也高的话,那么就可以判断进程等待的高负载原因就是CPU资源不足!

#### 计算密集型

对于计算密集型系统上,会看到%user占用的很高,%idle比较低

	Linux 3.11.10-301.fc20.i686 (localhost.localdomain) 	06/18/2014 	_i686_	(4 CPU)

	12:17:34 PM     CPU     %user     %nice   %system   %iowait    %steal     %idle
	12:17:36 PM     all     25.06      0.00      0.37      0.12      0.00     74.44
	12:17:38 PM     all     25.12      0.00      0.38      4.25      0.00     70.25
	12:17:40 PM     all     25.12      0.00      0.25      0.00      0.00     74.62
	12:17:42 PM     all     25.09      0.00      0.25      0.00      0.00     74.65
	12:17:44 PM     all     25.41      0.00      0.25      0.13      0.00     74.22
	12:17:46 PM     all     26.62      0.00      1.12      1.00      0.00     71.25
	12:17:48 PM     all     39.67      0.00      0.38      0.13      0.00     59.82
	12:17:50 PM     all     50.25      0.00      0.25      0.00      0.00     49.50
	12:17:52 PM     all     50.06      0.00      0.37      7.62      0.00     41.95
	12:17:54 PM     all     50.25      0.00      0.13      0.00      0.00     49.62
	12:17:56 PM     all     50.12      0.00      0.38      0.00      0.00     49.50
	12:17:58 PM     all     50.31      0.00      0.37      0.12      0.00     49.19

#### I/O密集型

I/O密集型中%iowait是I/O等待率,平均负载过高并且该值也过高的话,可以认为高负载原因就是I/O

%iowait比较高

	Linux 3.11.10-301.fc20.i686 (localhost.localdomain) 	06/18/2014 	_i686_	(4 CPU)

	01:49:04 PM     CPU     %user     %nice   %system   %iowait    %steal     %idle
	01:49:06 PM     all      3.16      0.00      5.44     30.85      0.00     60.56
	01:49:08 PM     all      2.63      0.00      4.64     72.77      0.00     19.95
	01:49:10 PM     all      2.38      0.00      4.51     44.74      0.00     48.37
	01:49:12 PM     all      2.78      0.00      4.17     32.87      0.00     60.18
	01:49:14 PM     all      2.90      0.00      4.67     25.47      0.00     66.96
	01:49:16 PM     all      2.40      0.00      3.41     37.12      0.00     57.07
	01:49:18 PM     all      3.02      0.00      4.28     46.73      0.00     45.97
	01:49:20 PM     all      2.28      0.00      4.05     37.85      0.00     55.82
	01:49:22 PM     all      2.89      0.00      5.03     40.00      0.00     52.08
	01:49:24 PM     all      2.41      0.00      2.29     53.11      0.00     42.19
	01:49:26 PM     all      1.15      0.00      2.05     43.99      0.00     52.81
	01:49:28 PM     all      1.28      0.00      2.04     46.81      0.00     49.87


#### 多CPU与多CPU使用率

多核就是虽然只有一个物理CPU,但是却能够看成是多个CPU,linux可以统计各个CPU的使用率

#### 计算密集型

	[root@ ~]# sar -P ALL | head -15
	Linux 3.11.10-301.fc20.i686 (localhost.localdomain) 	06/18/2014 	_i686_	(4 CPU)

	09:20:01 AM     CPU     %user     %nice   %system   %iowait    %steal     %idle
	09:30:01 AM     all      5.23      0.01      1.26      0.98      0.00     92.52
	09:30:01 AM       0      4.80      0.00      1.55      0.34      0.00     93.31
	09:30:01 AM       1      6.30      0.01      0.95      0.28      0.00     92.46
	09:30:01 AM       2      6.35      0.03      1.09      2.98      0.00     89.54
	09:30:01 AM       3      3.46      0.01      1.46      0.33      0.00     94.75
	09:40:01 AM     all      1.40      0.00      0.52      0.75      0.00     97.33
	09:40:01 AM       0      1.63      0.00      0.58      0.54      0.00     97.25
	09:40:01 AM       1      1.10      0.00      0.31      0.13      0.00     98.46
	09:40:01 AM       2      1.71      0.00      0.69      2.19      0.00     95.41
	09:40:01 AM       3      1.14      0.00      0.50      0.17      0.00     98.19
	
	可以看到对于%user,每个CPU上分配的相差不大


#### IO密集型

	[root@ Backup]# sar 1 5
	Linux 3.11.10-301.fc20.i686 (localhost.localdomain) 	06/19/2014 	_i686_	(4 CPU)

	10:49:10 AM     CPU     %user     %nice   %system   %iowait    %steal     %idle
	10:49:11 AM     all     24.56      0.00      1.75      0.00      0.00     73.68
	10:49:12 AM     all     13.25      0.00      1.25     11.50      0.00     74.00
	10:49:13 AM     all     13.32      0.00      1.01     13.07      0.00     72.61
	10:49:14 AM     all     10.50      0.00      1.50     16.50      0.00     71.50
	10:49:15 AM     all     11.00      0.00      1.50     26.25      0.00     61.25
	Average:        all     14.52      0.00      1.40     13.47      0.00     70.61



	在看每个CPU上IO的负载

	[root@ Backup]# sar -P ALL 1 2| head
	Linux 3.11.10-301.fc20.i686 (localhost.localdomain) 	06/19/2014 	_i686_	(4 CPU)

	10:49:32 AM     CPU     %user     %nice   %system   %iowait    %steal     %idle
	10:49:33 AM     all     22.31      0.00      1.75      2.51      0.00     73.43
	10:49:33 AM       0     88.00      0.00      3.00      0.00      0.00      9.00
	10:49:33 AM       1      0.00      0.00      1.00      0.00      0.00     99.00
	10:49:33 AM       2      0.00      0.00      2.04     10.20      0.00     87.76
	10:49:33 AM       3      0.00      0.00      0.00      0.00      0.00    100.00


	可以看到虽然平均iowait%只有2.51%,但是每个CPU分布却不同,因为虽然CPU有多个,但是磁盘只有一个,虽然CPU负载可以分散到其他CPU上去,但是I/O负载确实无法进行分散


